以下內容以固定闊度的「兩欄圖」顯示：左欄是價位/格階，右欄是動作/說明；時間由上到下。最後附上每種圖樣的風險緩解建議，並特別聚焦「每單沒有金額止損」這個核心風險。

說明
- 符號
  - RT/RC/RB = Range Top / Center / Bottom（區間頂/中/底）
  - r±k = 以 RC 為中心、間距為 step 的格階（r+1 = RC+step）
  - Px = 下單當刻市價
  - BL/SL = Buy/Sell LIMIT（回撤入市）
  - BS/SS = Buy/Sell STOP（突破入市；觸發價=格階±buffer）
  - TP = 下一格階止盈（TP_ToNextGridLevel=true）
  - (fill) = 掛單被觸發成持倉
  - (float -) = 浮虧；(close -$) = 平倉虧損（人工/MaxDD/規則）
- 預設
  - UseTrendFilter=true、AllowHedge=false（只順勢單邊）
  - PlaceAllGridLevels=false（只放最近一格），另有多層版本備註
  - 時間：自上而下

快速決策樹（EA 何時放甚麼單）
```
Supertrend 方向 (UP/DOWN/0) ──► 允許的單邊（UP→只BUY；DOWN→只SELL；0→不下新單）
                               │
StrategyProfile:
  ├─ PullbackOnly  ──► 用 LIMIT（UP: BL 於下方格階；DOWN: SL 於上方格階）
  ├─ BreakoutOnly  ──► 用 STOP（UP: BS 於上方格階+buffer；DOWN: SS 於下方格階-buffer）
  └─ AutoBySqueeze:
        PSI < 閾值 → BreakoutOnly
        PSI ≥ 閾值 → PullbackOnly
```

一、盈利情境（代表性）
A1. PullbackOnly（UP）回撤→反彈到下一格階止盈
```
價位      | 動作
----------+------------------------------------------
RT        |
r+3  4160 | TP 目標（由 4140 進場者）
Px   4150 | 下單當刻價格
r+2  4140 | [BL 放置] → (fill)
r+1  4120 | 
RC   4100 |
time ↓    | 觸價→成交→反彈→到 r+3 止盈（+$）
```

A2. BreakoutOnly（UP）突破延續→下一格階止盈
```
價位      | 動作
----------+------------------------------------------
r+4  4180 | TP 目標
r+3  4160 | [BS 於 4160+buffer] → (fill)
Px   4150 |
r+2  4140 |
RC   4100 |
time ↓    | 突破→觸發→延續上行→到 r+4 止盈（+$）
```

A3. PullbackOnly（DOWN）反彈到格階→回落止盈
```
價位      | 動作
----------+------------------------------------------
RT        |
r+2  4140 | [SL 放置] → (fill)
Px   4135 |
r+1  4120 | TP 目標
RC   4100 |
time ↓    | 反彈→做空成交→回落→到 r+1 止盈（+$）
```

A4. BreakoutOnly（DOWN）跌破延續→下一格階止盈
```
價位      | 動作
----------+------------------------------------------
RC   4100 |
r-1  4080 | TP 目標
r-2  4060 | [SS 於 4060-buffer] → (fill)
Px   4070 |
RB        |
time ↓    | 跌破→觸發→延續下行→到 r-1 止盈（+$）
```

A5. PlaceAllGridLevels=true（多層回撤階梯、UP）
```
價位      | 動作
----------+------------------------------------------
r+3       | 逐級止盈目標
r+2  4140 | [BL1] → (fill) → 反彈到 r+3 止盈（+$）
r+1  4120 | [BL2] → (fill) → 反彈到 r+2 止盈（+$）
RC   4100 | [BL3] → (候市)
time ↓    | 分批成交、分批在上方格階出場（階梯式盈利）
```

二、虧損情境（重點）
L1. PullbackOnly（UP）但動能繼續向下（無反彈）
```
價位      | 動作
----------+------------------------------------------
r+3  4160 | （未到）
Px   4150 |
r+2  4140 | [BL 放置] → (fill)
r+1  4120 | TP 目標（未到）
RC   4100 |
r-1  4080 | (float -) 持續擴大
r-2  4060 | (float --) 或觸發 MaxDD
time ↓    | 觸價成交→一路下跌→被動浮虧→（close -$）若風控/人工
為何虧：回撤單預期反彈，但趨勢續跌。
```

L2. BreakoutOnly（UP）假突破（觸發後回落）
```
價位      | 動作
----------+------------------------------------------
r+4  4180 | TP（未到）
r+3  4160 | [BS 於 4160+buffer] → (fill) → 隨即回落
Px   4150 |
r+2  4140 | (float -)
RC        |
time ↓    | 突破→觸發→回到區間→（close -$）若退出
為何虧：假突破/震盪誘多。
```

L3. BreakoutOnly（UP）靠近 RT（上方空間太少）
```
價位      | 動作
----------+------------------------------------------
RT  4185  | 頭頂空間極小（風險大）
r+3  4160 | [BS+buffer] → (fill) → 乏力→微回撤即浮虧
r+2  4140 |
RC        |
time ↓    | 有效突破也難以提供足夠 R:R
```

L4. PlaceAllGridLevels=true 在單邊下行（多層 BL 全被套）
```
價位      | 動作
----------+------------------------------------------
r+2  4140 | [BL1] (fill)
r+1  4120 | [BL2] (fill)
RC   4100 | [BL3] (fill)
r-1  4080 | [BL4] (fill) → 多倉累積 (float ---)
time ↓    | 階梯式加倉遇單邊下行→籃子風險快速放大
```

L5. 入場後 Supertrend 翻向（濾波滯後）
```
價位      | 動作
----------+------------------------------------------
r+3       | 原本 TP
r+2       | [BUY 已持倉]
RC        | ST 快速由 UP → DOWN
r-1       | 繼續下行 (float -) → 或 MaxDD 出場（close -$）
```

L6. AutoBySqueeze 閾值附近震盪（模式反覆切換）
```
價位      | 動作
----------+------------------------------------------
r+3       | [BS] → (fill) → 失敗
Px        |
r+2       | [BL] → (fill) → 再度失敗
RC        | 兩邊都在浮虧，形成「來回打臉」
```

L7. BreakoutOnly 的 buffer 太小（雜訊觸發）
```
價位      | 動作
----------+------------------------------------------
r+3       | [BS 於 rung+極小 buffer] → (fill) → 立即回落
r+2       | (float -) 噪音觸發
RC        |
```

L8. RecenterWhenRangeShifts 之後，舊倉位被「拋離」
```
位移前：             位移後（上移）：
RT₀ ──────           RT₁ ───────────
RC₀ ────── [BUY]     RC₁ ───────────  舊多單現處於新 RC 之下（浮虧）
RB₀ ──────           RB₁ ───────────
```

L9. 手續費/點差/滑點令「本應小勝」變「小負」
```
價位      | 動作
----------+------------------------------------------
r+2       | 幾乎觸及 TP，但淨值未達 → 退出 (close -$ 小)
r+1  BL   | (fill) → 微反彈 → 因成本摩擦未能轉正
RC        |
```

三、風險緩解（逐圖樣對應）
- 核心風險：每單沒有「金額止損」→ 小概率單邊/假突破時，浮虧無上限，靠 MaxDD 或人工才止血。
- 建議同時從「入場質素」+「風控出場」兩端處理。

總體建議（可逐步加入到 EA）
1) 每單金額止損／ATR 止損（強烈建議）
   - 方案A：Money SL（例如 PerOrderSLMoney = $X），配合最小手數計算點距離，設置 SL 價格。
   - 方案B：ATR 倍數 SL（如 1.5–2.5 ATR），隨波動自適應。
   - 方案C：格階感知 SL（如多單 SL 放在入場格階下一格/兩格之下，空單反之）。
2) 交易品質提升
   - 為 Breakout 設置 ATR‑Scaled buffer（如 0.2–0.4 ATR），降低 L7/L2 假突破概率。
   - 「避免邊界」規則：當目標格階距 RT/RB 僅 <X% 區間高度時，不下新單（緩解 L3）。
   - Squeeze 閾值加「遲滯帶」：PSI < 70 才切 Breakout；PSI > 85 才回 Pullback（減少 L6 切換抖動）。
   - Trend 中性（ST=0）期間禁止新單，且可選擇撤回未成交掛單（避免在不明朗期被觸發）。
3) 倉位與格網控制
   - PlaceAllGridLevels=false 做為默認；僅在明確均值回歸環境才開多層格網（緩解 L4）。
   - MaxOrdersPerSide/手數遞增規則：限制敞口；配合梯度手數更平滑。
   - Recenter 自動處理：新增「AutoRebuildOnRegimeChange」與「AutoRebuildOnRecenter」選項，切換時自動清理不匹配掛單，減少 H 風險。
4) 出場優化
   - Time‑Stop：單筆逾時未達 TP/SL，自動減倉或移至更緊的風險界。
   - Basket 風控：分級籃子止損/減倉（例如 -3%、-5%、-8% 分別減倉 20/30/50%）。
   - 移動止損：Breakout 成交後，可用 swing/ATR 跟蹤移動止損，將 L2 假突破損失限制在可控範圍。
5) 成本摩擦管理
   - 以點差/佣金作為最小盈利目標的底線（若 TP < 成本*倍數則不下單），緩解 L9。
   - 避免重大新聞時段或用更大 buffer。

圖樣對應要點
- L1/L4/L5/H：加 Money SL / ATR SL、限制層數、分級籃子止損、AutoRebuild。
- L2/L3/L7：ATR‑buffer、避免接近 RT/RB、加確認（如收線於格階上/下）。
- L6：PSI 遲滯帶、在模式切換時撤回相反類型掛單。
- L9：提高 TP 距離或關閉短距離交易；成交成本檢查。

四、額外補充（你可選開啟）
- Missed‑Trade（非盈非虧）：buffer 太大、ST=0、或避免邊界規則會令機會減少；但這是「用時間換風險」的取捨。
- 視覺/回測輔助：在圖上標示當時的 ST 方向與 PSI 值、以及「為何不下單」的原因（如靠近 RT），方便事後審視。

如果你願意提供當前數值（RT/RB/RC、step、Px、ST 方向、PSI、EntryBufferPoints、PlaceAllGridLevels），我可以即場輸出「你的盤面專屬」圖，逐行指出可能的盈虧路徑與對應風控。